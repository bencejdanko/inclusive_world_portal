{% extends 'base_portal.html' %}
{% load i18n %}

{% block title %}Surveys{% endblock %}

{% block content %}
<div class="">
  <div class="mb-4">
    <h2 class="h4 mb-2" style="color: var(--color-brand-black-olive);">Surveys</h2>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  {% if surveys %}
    <div class="d-flex flex-column gap-2">
      {% for survey in surveys %}
        <a href="{{ survey.get_absolute_url }}" class="text-decoration-none">
          <div class="card survey-card" style="border: 1px solid var(--color-border); transition: all 0.2s ease;">
            <div class="card-body py-2 px-3">
              <div class="d-flex align-items-center justify-content-between">
                <div class="flex-grow-1 me-3">
                  <h3 class="mb-0 h6 fw-semibold" style="line-height: 1.2; color: var(--color-brand-black-olive);">
                    {{ survey.name }}
                  </h3>
                </div>
                <div class="d-flex align-items-center gap-2 flex-shrink-0 small">
                  {% if user.is_authenticated %}
                    {% with user_responses=survey.responses.all %}
                      {% if user_responses %}
                        {% for response in user_responses %}
                          {% if response.user.id == user.id %}
                            <span class="badge survey-badge-submitted" title="In Progress - Last updated {{ response.updated|date:'M j, Y' }}">
                              <i class="bi bi-check-circle-fill"></i>
                              <span class="d-none d-sm-inline ms-1">{% trans "Submitted" %}</span>
                            </span>
                          {% endif %}
                        {% endfor %}
                      {% endif %}
                    {% endwith %}
                  {% endif %}
                  {% if survey.expire_date %}
                    <span class="badge survey-badge-deadline" title="Deadline: {{ survey.expire_date|date:'F j, Y' }}">
                      <i class="bi bi-calendar-event"></i>
                      <span class="d-none d-sm-inline ms-1">{{ survey.expire_date|date:"M j" }}</span>
                    </span>
                  {% endif %}
                  {% if survey.need_logged_user %}
                    <span class="badge survey-badge-auth" title="Login Required">
                      <i class="bi bi-person-lock"></i>
                    </span>
                  {% endif %}
                  <i class="bi bi-chevron-right" style="color: var(--color-brand-berry);"></i>
                </div>
              </div>
            </div>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info" role="alert" style="background: rgba(0, 139, 156, 0.1); border-left: 4px solid var(--color-brand-splashy-aqua); border-color: var(--color-brand-splashy-aqua);">
      <i class="bi bi-info-circle me-2" style="color: var(--color-brand-splashy-aqua);"></i>
      <span style="color: var(--color-brand-black-olive);">{% trans "No surveys are currently available for your role." %}</span>
    </div>
  {% endif %}
</div>

<style>
  .survey-card {
    background: var(--color-card-bg);
    transition: all 0.2s ease;
    box-shadow: var(--shadow-sm);
  }
  
  .survey-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: var(--color-brand-berry) !important;
  }
  
  .survey-badge-submitted {
    background: var(--color-badge-light-green);
    color: var(--color-badge-dark-green);
    border: 1px solid var(--color-badge-dark-green);
  }
  
  .survey-badge-deadline {
    background: var(--color-brand-afterglow-yellow);
    color: var(--color-badge-dark-yellow);
    border: 1px solid var(--color-badge-dark-yellow);
  }
  
  .survey-badge-auth {
    background: var(--color-brand-splashy-aqua);
    color: white;
    border: 1px solid var(--color-brand-blue-peacock);
  }
</style>
{% endblock %}
