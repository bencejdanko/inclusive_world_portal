apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: inclusive-world-portal

resources:
  # Namespace
  - namespace.yaml
  
  # Configuration
  # Note: ConfigMap is now generated below via configMapGenerator
  # Note: secrets.yaml should be created manually or with external-secrets
  
  # PostgreSQL
  - postgres/statefulset.yaml
  - postgres/service.yaml
  
  # Redis
  - redis/deployment.yaml
  - redis/service.yaml
  - redis/pvc.yaml
  
  # MinIO
  - minio/statefulset.yaml
  - minio/service.yaml
  - minio/init-job.yaml
  
  # Django
  - django/deployment.yaml
  - django/service.yaml
  - django/pvc.yaml
  - django/hpa.yaml
  
  # Celery
  - celery/worker-deployment.yaml
  - celery/beat-deployment.yaml
  - celery/pvc.yaml
  - celery/worker-hpa.yaml
  
  # Nginx
  - nginx/ingress.yaml

labels:
  - pairs:
      app.kubernetes.io/name: inclusive-world-portal
      app.kubernetes.io/managed-by: argocd

configMapGenerator:
  - name: inclusive-world-config
    literals:
      - DJANGO_SETTINGS_MODULE=config.settings.production
      - DJANGO_ALLOWED_HOSTS=*
      - POSTGRES_DB=inclusive_world_portal
      - POSTGRES_USER=postgres
      - POSTGRES_HOST=postgres
      - POSTGRES_PORT=5432
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_URL=redis://redis:6379/0
      - AWS_STORAGE_BUCKET_NAME=inclusive-world-media
      - AWS_S3_ENDPOINT_URL=http://minio:9000
      - AWS_S3_REGION_NAME=us-east-1
      - AWS_S3_CUSTOM_DOMAIN=
      - CELERY_BROKER_URL=redis://redis:6379/0
      - CELERY_RESULT_BACKEND=redis://redis:6379/0
      - USE_DOCKER=yes
      - IPYTHONDIR=/app/.ipython
      - DJANGO_ADMIN_URL=admin/
      - SENTRY_DSN=

images:
  - name: bencejdanko/inclusive-world-portal
    newName: bencejdanko/inclusive-world-portal
    newTag: f71b9f3
